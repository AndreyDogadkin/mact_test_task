# Тестовое задание "МАСТ"

## Задание

Требуется написать 2 небольших приложения: клиентское приложение с интерфейсом на базе Qt6 и
серверную часть RestAPI на базе Flask.
___

## Задачи

* Клиент:
    * В основном окне приложения должны быть расположены следующие элементы:
      QLineEdit, QListView, QPushButton 2шт.
    * По нажатию одной кнопки должен отправиться запрос POST через библиотеку requests
      к серверу в виде json структуры и содержать в себе информацию: текст из QlineEdit,
      текущую дату, текущее время, порядковый номер нажатия.
    * По нажатию второй кнопки отправляется запрос GET через библиотеку requests к серверу,
      который возвращает данные в виде json структуры и эту информацию отобразить в QlistView.
* Сервер:
    * У сервера должно быть два эндпоинта.
    * На один эндпоинт разрешено делать только POST запрос. При поступлении запроса с данными
      в json формате на этот эндпоинт они записываются в таблицу в базе данных SQLite.
    * На второй эндпоинт разрешено делать только GET запрос. При поступлении запроса на этот
      эндпоинт из таблицы данных в базе SQLite забираются все записи и возвращаются клиенту
      в json формате.
* Общие:
    * Написать как минимум 3 теста для клиента и для сервера с использованием pytest.
    * Когда задание будет выполнено, собрать приложения в *.exe файлы.

___

## Быстрый запуск

* Из корневой директории проекта перейдите в директорию `executable_files`
* Перейдите в директорию с названием вашей операционной системы
* Запустите исполняемые файлы `server` и `client`

___

## Реализация:

### Клиент

Структура приложения:

```
. client
├── app   
│   ├── __init__.py
│   ├── base
│   │   ├── __init__.py
│   │   ├── exceptions.py -------------- # Кастомные исключения
│   │   ├── helpers.py ----------------- # Вспомогательные функции
│   │   ├── main-ui.ui ----------------- # ui файл сгенерированный через QtDesigner
│   │   └── main_ui.py
│   ├── config.py ---------------------- # Конфигурационный файл
│   ├── core
│   │   ├── __init__.py
│   │   └── services
│   │       ├── __init__.py
│   │       └── to_server_requests.py -- # Запросы к эндпоинтам сервера
│   ├── response_schemas
│   │   ├── __init__.py
│   │   └── response_text_count.py ----- # Схемы для валидации ответов
│   └── ui ----------------------------- # Пользовательский интерфейс
│       ├── __init__.py
│       └── main_window.py ------------- # Главное окно приложения
├── app_start.py
├── requirements.txt ------------------- # Зависимости приложения
└── tests ------------------------------ # Тесты
    ├── __init__.py
    ├── conftest.py
    └── test_main_window.py
```

### Пользовательский интерфейс:

* Реализован на базе pyQt6 и QtDesigner
* QLineEdit, QListView 2 шт, QPushButton 2шт
* При нажатии на кнопку GET отображаются все записи из базы данных сервера в отформатированном виде
* При нажатии на кнопку POST создается запись в базе данных и отображается в отформатированном виде

<a href="https://ibb.co/hy2J05d"><img src="https://i.ibb.co/0cYR5N9/2024-02-13-07-39-42.png" alt="2024-02-13-07-39-42" width="50%" height="50%" border="0"></a>

### Логика:

* Нажатие кнопки "GET":
    * Отправляется GET запрос на сервер
    * Ответ сервера проходит валидацию и сериализацию
    * Форматируется
    * Выводится пользователю
* Нажатие кнопки "POST":
    * Собираются данные: дата, время, счетчик нажатий кнопки "POST" за сессию и тест из поля ввода
    * Отправляется пост запрос на сервер с собранными данными в JSON
    * Ответ сервера проходит валидацию и сериализацию
    * Форматируется
    * Пользователю выводится созданная в базе данных запись

### Команды:

#### Запуск:

Из директории client выполните команду: `python app_start.py`

#### Сборка в исполняемый файл:

Из директории client выполните
команду: `pyinstaller --name client --onefile --noconsole app_start.py`

#### Прогон тестов:

Из директории client выполните команду: `pytest`

### Используемые библиотеки:

* PyQt6 - Пользовательский интерфейс
* requests - Запросы к серверу
* pydantic - Валидация и сериализация ответов
* pytest - Тестирование
* pytest-qt - Тестирование
* pyinstaller - Упаковка приложения в исполняемый файл

___

## Сервер

### Структура приложения:

```
. server
├── app
│   ├── __init__.py --------------- # Инициализация приложения
│   ├── config.py ----------------- # Конфигурационный файл
│   ├── core
│   │   ├── __init__.py
│   │   └── services
│   │       ├── __init__.py
│   │       └── db_methods.py ----- # Взаимодействие с БД
│   ├── models -------------------- # Модели 
│   │   ├── __init__.py
│   │   ├── base.py
│   │   └── text_and_count.py
│   ├── schemas ------------------- # Схемы для валидации
│   │   ├── __init__.py
│   │   └── text_and_count.py
│   └── views --------------------- # Представление объектов
│       ├── __init__.py
│       └── api_views.py
├── app_start.py ------------------ # Скрипт для быстрого запуска приложения
├── migrations -------------------- # Миграции
│   ├── README
│   ├── alembic.ini
│   ├── env.py
│   ├── script.py.mako
│   └── versions
│       └── 1723acce13ed_.py
├── requirements.txt -------------- # Зависимости приложения
└── tests ------------------------- # Тесты
    ├── __init__.py
    ├── conftest.py
    └── test_api.py
```

### Описание:

**База данных:**

* Приложение настроено для взаимодействия с БД SQlite3
* Взаимодействие осуществляется через SQLAlchemy
* Реализовано изменение структуры через миграции Alembic
* База данных состоит из одной таблицы *"text_and_count"* с полями:
    * id <primary key>
    * text <str>
    * counter <int>
    * local_time <time>
    * local_date <date>
    * date_time_added_utc <datetime>

**Эндпоинты:**

* #### /api/counters/ -- GET
    * Возвращает все записи из таблицы *"text_and_count"*
      ```
          # Пример ответа
          [
            {
              "counter": 2,
              "date_time_added_utc": "2024-02-12T21:29:44.890296",
              "id": 1,
              "local_date": "2024-02-13",
              "local_time": "00:30:00.893672",
              "text": "Example1"
            },
            {
              "counter": 1,
              "date_time_added_utc": "2024-02-13T03:05:25.357695",
              "id": 2,
              "local_date": "2024-02-13",
              "local_time": "06:06:34.999611",
              "text": "Example2"
            }
          ]
      ```
* #### /api/counters/ -- POST
    * Создает запись в таблице *"text_and_count"*
    * Обязательные поля:
       ```
       "text": <str>,
       "counter": <int>,
       "local_time": <str, %H:%M:%S>,
       "local_date": <str, %Y-%m-%d>
       ```
    * При успешном запросе возвращает созданную запись
      ```
      # Пример ответа
      {
          "counter": 1,
          "date_time_added_utc": "2024-02-13T03:27:25.597684",
          "id": 4,
          "local_date": "2024-02-13",
          "local_time": "06:06:34.999611",
          "text": "example text"
      }
      ```

### Команды:

#### Запуск:

Из директории server выполните команду: `flask run` или `python app_start.py`

#### Миграции:

Из директории server выполните команды:

```
flask db migrate
flask db upgrade
```

#### Сборка в исполняемый файл:

Из директории server выполните команду: `pyinstaller --name server --onefile app_start.py`

#### Прогон тестов:

Из директории server выполните команду: `pytest`

### Используемые библиотеки:

* Flask - База приложения
* Flask-Migrate - Миграции
* Flask-SQLAlchemy - Взаимодействие с БД
* flask-marshmallow - Сериализация и десериализация данных
* marshmallow-sqlalchemy - Генерация схем
* pytest - Тестирование
* pyinstaller - Упаковка приложения в исполняемый файл